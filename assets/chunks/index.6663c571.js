import{i as u,l as A,B as F,J as L,E as w,o as h,c as f,F as P,g as W,k as I,j as K,s as O,K as S}from"../app.a85c5ba3.js";const R=n=>{const e=[];return n.forEach(o=>{e.push(...o.getElementsByTagName("img"))}),e},q=n=>n.map(e=>e.src),z=n=>{let e=[];return n.forEach((o,l)=>{e[l]=new Promise((d,m)=>{const c=new Image;c.src=o,c.onload=()=>{d({img:o,index:l})}})}),Promise.all(e)},k=n=>{const e=Object.values(n);return Math.min(...e)},J=n=>{const e=Object.values(n);return Math.max(...e)},b=n=>{const e=k(n);return Object.keys(n).find(o=>n[o]===e)},V={__name:"index",props:{data:{type:Array,required:!0},nodeKey:{type:String},column:{default:2,type:Number},columnSpacing:{default:20,type:Number},rowSpacing:{default:20,type:Number},picturePreReading:{type:Boolean,default:!0}},setup(n){const e=n,o=u(0),l=u({}),d=()=>{l.value={};for(let t=0;t<e.column;t++)l.value[t]=0},m=u(null),c=u(0),p=u(0),x=()=>{const{paddingLeft:t,paddingRight:a}=getComputedStyle(m.value,null);p.value=parseFloat(t),c.value=m.value.offsetWidth-parseFloat(t)-parseFloat(a)},r=u(0),B=A(()=>(e.column-1)*e.columnSpacing),y=()=>{x(),r.value=(c.value-B.value)/e.column};F(()=>{y()});let i=[];const N=()=>{i=[];let t=[...document.getElementsByClassName("m-waterfall-item")];const a=R(t),s=q(a);z(s).then(()=>{t.forEach(g=>{i.push(g.offsetHeight)}),v()})},T=()=>{i=[],[...document.getElementsByClassName("m-waterfall-item")].forEach(a=>{i.push(a.offsetHeight)}),v()},v=()=>{e.data.forEach((t,a)=>{t._style||(t._style={},t._style.left=_(),t._style.top=j(),M(a))}),o.value=J(l.value)},_=()=>b(l.value)*(r.value+e.columnSpacing)+p.value,j=()=>k(l.value),M=t=>{const a=b(l.value);l.value[a]+=i[t]+e.rowSpacing};L(()=>{e.data.forEach(t=>{delete t._style})}),w(()=>e.data,t=>{t.every(s=>!s._style)&&d(),S(()=>{e.picturePreReading?N():T()})},{immediate:!0,deep:!0});const E=()=>{setTimeout(()=>{y(),e.data.forEach(t=>{t._style=null})},100)};return w(()=>e.column,()=>{e.picturePreReading?(r.value=0,S(E)):E()}),(t,a)=>(h(),f("div",{class:"relative",ref_key:"containerTarget",ref:m,style:I({height:o.value+"px"})},[r.value&&n.data.length?(h(!0),f(P,{key:0},W(n.data,(s,g)=>{var H,C;return h(),f("div",{class:"m-waterfall-item absolute duration-300",style:I({width:r.value+"px",left:((H=s._style)==null?void 0:H.left)+"px",top:((C=s._style)==null?void 0:C.top)+"px"}),key:n.nodeKey?s[n.nodeKey]:g},[K(t.$slots,"default",{item:s,width:r.value,index:g})],4)}),128)):O("",!0)],4))}};export{V as default};
